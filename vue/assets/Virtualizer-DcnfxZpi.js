import{d as R,r as b,c as m,o as x,a as E,w as S,f as v,q as O}from"./iframe-CKFz32Me.js";import{c as V,a as C,U as L,b as j,d as w,g as M,s as P,e as H,f as U,L as F,i as k,A as B,h as D}from"./utils-Cf0391Bq.js";function q(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!O(e)}const G={data:{type:Array,required:!0},bufferSize:Number,itemSize:Number,shift:Boolean,horizontal:Boolean,startMargin:{type:Number,default:0},ssrCount:Number,scrollRef:Object,as:{type:String,default:"div"},item:{type:String,default:"div"},itemProps:Function,keepMounted:Array,cache:Object},K=R({props:G,emits:["scroll","scrollEnd"],setup(e,{emit:g,expose:T,slots:I}){let _=!!e.ssrCount;const l=e.horizontal,$=b(),t=V(e.data.length,e.itemSize,e.ssrCount,e.cache,!e.itemSize),f=H(t,l),r=C(t,l),i=b(t.$getStateVersion());t.$subscribe(L,()=>{i.value=t.$getStateVersion()}),t.$subscribe(j,()=>{g("scroll",t.$getScrollOffset())}),t.$subscribe(w,()=>{g("scrollEnd")});const z=m(n=>{i.value;const a=t.$getRange(e.bufferSize);return n&&k(n,a)?n:a}),N=m(()=>i.value&&t.$isScrolling()),A=m(()=>i.value&&t.$getTotalSize());return x(()=>{_=!1;const n=$.value,a=requestAnimationFrame(()=>{const c=d=>{f.$observeRoot(d),r.$observe(n,d)};e.scrollRef?c(e.scrollRef):c(n.parentElement)});E(()=>{cancelAnimationFrame(a)})}),E(()=>{t.$dispose(),f.$dispose(),r.$dispose()}),S(()=>e.data.length,n=>{t.$update(B,[n,e.shift])}),S(()=>e.startMargin,n=>{t.$update(D,n)},{immediate:!0}),S([i],()=>{r.$fixScrollJump()},{flush:"post"}),T({get cache(){return t.$getCacheSnapshot()},get scrollOffset(){return t.$getScrollOffset()},get scrollSize(){return M(t)},get viewportSize(){return t.$getViewportSize()},findItemIndex:t.$findItemIndex,getItemOffset:t.$getItemOffset,getItemSize:t.$getItemSize,scrollToIndex:r.$scrollToIndex,scrollTo:r.$scrollTo,scrollBy:r.$scrollBy}),()=>{const n=e.as,a=e.item,c=A.value,d=r.$isNegative(),u=[],h=s=>{const o=I.default({item:e.data[s],index:s})[0];return v(F,{key:U(o,s),_stateVersion:i,_store:t,_resizer:f.$observeItem,_index:s,_children:o,_isHorizontal:l,_isNegative:d,_isSSR:_,_as:a,_itemProps:e.itemProps?.({item:e.data[s],index:s})},null,8,["_stateVersion","_store","_resizer","_index","_children","_isHorizontal","_isNegative","_isSSR","_as","_itemProps"])};if(e.keepMounted){const s=new Set(e.keepMounted);for(let[o,y]=z.value;o<=y;o++)s.add(o);P([...s]).forEach(o=>{u.push(h(o))})}else for(let[s,o]=z.value;s<=o;s++)u.push(h(s));return v(n,{ref:$,style:{contain:"size style",overflowAnchor:"none",flex:"none",position:"relative",width:l?c+"px":"100%",height:l?"100%":c+"px",pointerEvents:N.value?"none":void 0}},q(u)?u:{default:()=>[u],_:2},8,["style"])}}});export{K as V};
