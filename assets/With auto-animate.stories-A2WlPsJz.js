import{j as u}from"./jsx-runtime-D_zvdyIk.js";import{r as h}from"./iframe-BoI5bJ6Z.js";import{f as nt}from"./chunk-4X5ZEQ5K-DKZdp5Hc.js";import{V}from"./Virtualizer-BZXmzB2E.js";import"./useLatestRef-CzhV_rsI.js";import"./useChildren-GZDHuoaX.js";import"./index-M_VcXNYe.js";import"./index-exaFy-fc.js";const D=new Set,f=new WeakMap,M=new WeakMap,m=new WeakMap,k=new WeakMap,L=new WeakMap,R=new WeakMap,C=new WeakMap,x=new WeakMap,S=new WeakSet;let p,$=0,H=0;const b="__aa_tgt",_="__aa_del",B="__aa_new",Q=t=>{const e=st(t);e&&e.forEach(o=>at(o))},ot=t=>{t.forEach(e=>{e.target===p&&it(),f.has(e.target)&&T(e.target)})};function G(t){const e=t.getBoundingClientRect(),o=p?.clientWidth||0,n=p?.clientHeight||0;return e.bottom<0||e.top>n||e.right<0||e.left>o}function Y(t){const e=k.get(t);e?.disconnect();let o=f.get(t),n=0;const i=5;o||(o=W(t),f.set(t,o));const{offsetWidth:r,offsetHeight:s}=p,d=[o.top-i,r-(o.left+i+o.width),s-(o.top+i+o.height),o.left-i].map(c=>`${-1*Math.floor(c)}px`).join(" "),l=new IntersectionObserver(()=>{++n>1&&T(t)},{root:p,threshold:1,rootMargin:d});l.observe(t),k.set(t,l)}function T(t,e=!0){clearTimeout(x.get(t));const o=A(t),n=e?N(o)?500:o.duration:0;x.set(t,setTimeout(async()=>{const i=m.get(t);try{await i?.finished,f.set(t,W(t)),Y(t)}catch{}},n))}function it(){clearTimeout(x.get(p)),x.set(p,setTimeout(()=>{D.forEach(t=>P(t,e=>J(()=>T(e))))},100))}function rt(t){setTimeout(()=>{R.set(t,setInterval(()=>J(T.bind(null,t)),2e3))},Math.round(2e3*Math.random()))}function J(t){typeof requestIdleCallback=="function"?requestIdleCallback(()=>t()):requestAnimationFrame(()=>t())}let y;const K=typeof window<"u"&&"ResizeObserver"in window;K&&(p=document.documentElement,new MutationObserver(Q),y=new ResizeObserver(ot),window.addEventListener("scroll",()=>{H=window.scrollY,$=window.scrollX}),y.observe(p));function st(t){return t.reduce((n,i)=>[...n,...Array.from(i.addedNodes),...Array.from(i.removedNodes)],[]).every(n=>n.nodeName==="#comment")?!1:t.reduce((n,i)=>{if(n===!1)return!1;if(i.target instanceof Element){if(z(i.target),!n.has(i.target)){n.add(i.target);for(let r=0;r<i.target.children.length;r++){const s=i.target.children.item(r);if(s){if(_ in s)return!1;z(i.target,s),n.add(s)}}}if(i.removedNodes.length)for(let r=0;r<i.removedNodes.length;r++){const s=i.removedNodes[r];if(_ in s)return!1;s instanceof Element&&(n.add(s),z(i.target,s),M.set(s,[i.previousSibling,i.nextSibling]))}}return n},new Set)}function z(t,e){!e&&!(b in t)?Object.defineProperty(t,b,{value:t}):e&&!(b in e)&&Object.defineProperty(e,b,{value:t})}function at(t){var e,o;const n=t.isConnected,i=f.has(t);n&&M.has(t)&&M.delete(t),((e=m.get(t))===null||e===void 0?void 0:e.playState)!=="finished"&&((o=m.get(t))===null||o===void 0||o.cancel()),B in t?q(t):i&&n?dt(t):i&&!n?lt(t):q(t)}function w(t){return Number(t.replace(/[^0-9.\-]/g,""))}function ct(t){let e=t.parentElement;for(;e;){if(e.scrollLeft||e.scrollTop)return{x:e.scrollLeft,y:e.scrollTop};e=e.parentElement}return{x:0,y:0}}function W(t){const e=t.getBoundingClientRect(),{x:o,y:n}=ct(t);return{top:e.top+n,left:e.left+o,width:e.width,height:e.height}}function Z(t,e,o){let n=e.width,i=e.height,r=o.width,s=o.height;const a=getComputedStyle(t);if(a.getPropertyValue("box-sizing")==="content-box"){const l=w(a.paddingTop)+w(a.paddingBottom)+w(a.borderTopWidth)+w(a.borderBottomWidth),c=w(a.paddingLeft)+w(a.paddingRight)+w(a.borderRightWidth)+w(a.borderLeftWidth);n-=c,r-=c,i-=l,s-=l}return[n,r,i,s].map(Math.round)}function A(t){return b in t&&C.has(t[b])?C.get(t[b]):{duration:250,easing:"ease-in-out"}}function tt(t){if(b in t)return t[b]}function X(t){const e=tt(t);return e?S.has(e):!1}function P(t,...e){e.forEach(o=>o(t,C.has(t)));for(let o=0;o<t.children.length;o++){const n=t.children.item(o);n&&e.forEach(i=>i(n,C.has(n)))}}function F(t){return Array.isArray(t)?t:[t]}function N(t){return typeof t=="function"}function dt(t){const e=f.get(t),o=W(t);if(!X(t))return f.set(t,o);if(G(t)){f.set(t,o),Y(t);return}let n;if(!e)return;const i=A(t);if(typeof i!="function"){let r=e.left-o.left,s=e.top-o.top;const a=e.left+e.width-(o.left+o.width);e.top+e.height-(o.top+o.height)==0&&(s=0),a==0&&(r=0);const[l,c,O,g]=Z(t,e,o),v={transform:`translate(${r}px, ${s}px)`},E={transform:"translate(0, 0)"};l!==c&&(v.width=`${l}px`,E.width=`${c}px`),O!==g&&(v.height=`${O}px`,E.height=`${g}px`),n=t.animate([v,E],{duration:i.duration,easing:i.easing})}else{const[r]=F(i(t,"remain",e,o));n=new Animation(r),n.play()}m.set(t,n),f.set(t,o),n.addEventListener("finish",T.bind(null,t,!1),{once:!0})}function q(t){B in t&&delete t[B];const e=W(t);f.set(t,e);const o=A(t);if(!X(t))return;if(G(t)){Y(t);return}let n;if(typeof o!="function")n=t.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:o.duration*1.5,easing:"ease-in"});else{const[i]=F(o(t,"add",e));n=new Animation(i),n.play()}m.set(t,n),n.addEventListener("finish",T.bind(null,t,!1),{once:!0})}function U(t,e){var o;t.remove(),f.delete(t),M.delete(t),m.delete(t),(o=k.get(t))===null||o===void 0||o.disconnect(),setTimeout(()=>{if(_ in t&&delete t[_],Object.defineProperty(t,B,{value:!0,configurable:!0}),e&&t instanceof HTMLElement)for(const n in e)t.style[n]=""},0)}function lt(t){var e;if(!M.has(t)||!f.has(t))return;const[o,n]=M.get(t);Object.defineProperty(t,_,{value:!0,configurable:!0});const i=window.scrollX,r=window.scrollY;if(n&&n.parentNode&&n.parentNode instanceof Element?n.parentNode.insertBefore(t,n):o&&o.parentNode?o.parentNode.appendChild(t):(e=tt(t))===null||e===void 0||e.appendChild(t),!X(t))return U(t);const[s,a,d,l]=ut(t),c=A(t),O=f.get(t);(i!==$||r!==H)&&ft(t,i,r,c);let g,v={position:"absolute",top:`${s}px`,left:`${a}px`,width:`${d}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!N(c))Object.assign(t.style,v),g=t.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:c.duration,easing:"ease-out"});else{const[E,j]=F(c(t,"remove",O));j?.styleReset!==!1&&(v=j?.styleReset||v,Object.assign(t.style,v)),g=new Animation(E),g.play()}m.set(t,g),g.addEventListener("finish",()=>U(t,v),{once:!0})}function ft(t,e,o,n){const i=$-e,r=H-o,s=document.documentElement.style.scrollBehavior;if(getComputedStyle(p).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+i,window.scrollY+r),!t.parentElement)return;const d=t.parentElement;let l=d.clientHeight,c=d.clientWidth;const O=performance.now();function g(){requestAnimationFrame(()=>{if(!N(n)){const v=l-d.clientHeight,E=c-d.clientWidth;O+n.duration>performance.now()?(window.scrollTo({left:window.scrollX-E,top:window.scrollY-v}),l=d.clientHeight,c=d.clientWidth,g()):document.documentElement.style.scrollBehavior=s}})}g()}function ut(t){var e;const o=f.get(t),[n,,i]=Z(t,o,W(t));let r=t.parentElement;for(;r&&(getComputedStyle(r).position==="static"||r instanceof HTMLBodyElement);)r=r.parentElement;r||(r=document.body);const s=getComputedStyle(r),a=!m.has(t)||((e=m.get(t))===null||e===void 0?void 0:e.playState)==="finished"?W(r):f.get(r),d=Math.round(o.top-a.top)-w(s.borderTopWidth),l=Math.round(o.left-a.left)-w(s.borderLeftWidth);return[d,l,n,i]}function pt(t,e={}){if(K&&y&&!(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!N(e)&&!e.disrespectUserMotionPreference)){S.add(t),getComputedStyle(t).position==="static"&&Object.assign(t.style,{position:"relative"}),P(t,T,rt,s=>y?.observe(s)),N(e)?C.set(t,e):C.set(t,{duration:250,easing:"ease-in-out",...e});const r=new MutationObserver(Q);r.observe(t,{childList:!0}),L.set(t,r),D.add(t)}return Object.freeze({parent:t,enable:()=>{S.add(t)},disable:()=>{S.delete(t),P(t,n=>{const i=m.get(n);try{i?.cancel()}catch{}m.delete(n);const r=x.get(n);r&&clearTimeout(r),x.delete(n);const s=R.get(n);s&&clearInterval(s),R.delete(n)})},isEnabled:()=>S.has(t),destroy:()=>{S.delete(t),D.delete(t),C.delete(t);const n=L.get(t);n?.disconnect(),L.delete(t),P(t,i=>{y?.unobserve(i);const r=m.get(i);try{r?.cancel()}catch{}m.delete(i);const s=k.get(i);s?.disconnect(),k.delete(i);const a=R.get(i);a&&clearInterval(a),R.delete(i);const d=x.get(i);d&&clearTimeout(d),x.delete(i),f.delete(i),M.delete(i)})}})}function ht(t){const[e,o]=h.useState(),n=h.useMemo(()=>t,[]),i=h.useCallback(s=>{s instanceof HTMLElement?o(pt(s,n)):o(void 0)},[n]),r=h.useCallback(s=>{e&&(s?e.enable():e.disable())},[e]);return h.useEffect(()=>()=>{var s;(s=e?.destroy)===null||s===void 0||s.call(e)},[e]),[i,r]}function mt(t){return e=>{for(const o of t)I(o,e)}}function gt(t){return e=>{const o=[];for(const n of t){const i=I(n,e),r=typeof i=="function";o.push(r?i:()=>I(n,null))}return()=>{for(const n of o)n()}}}function I(t,e){if(typeof t=="function")return t(e);t&&(t.current=e)}var vt=parseInt(h.version.split(".")[0],10)>=19?gt:mt;const St={component:V},wt=({children:t,isStart:e,isEnd:o,onUp:n,onDown:i,onDelete:r})=>u.jsxs("div",{style:{padding:10,height:40,display:"flex",borderBottom:"solid 1px #ccc",background:"#fff"},children:[u.jsx("div",{style:{flex:1},children:t}),u.jsxs("div",{style:{display:"flex"},children:[u.jsx("button",{disabled:e,onClick:n,children:"up"}),u.jsx("button",{disabled:o,onClick:i,children:"down"}),u.jsx("button",{onClick:r,children:"delete"})]})]}),et=h.createContext(null),yt=h.forwardRef((t,e)=>{const o=h.useContext(et);return u.jsx("div",{ref:h.useMemo(()=>vt([e,o]),[e,o]),...t})}),Wt={name:"With auto-animate",render:()=>{const t=h.useRef(0),e=()=>({id:++t.current,data:nt.music.songName()}),[o,n]=h.useState(()=>Array.from({length:100},e)),[i,r]=ht(),s=h.useRef(!1);return u.jsxs("div",{style:{height:"100vh",width:"400px",display:"flex",flexDirection:"column"},children:[u.jsx(et.Provider,{value:i,children:u.jsx("div",{style:{overflowY:"auto",flex:1},children:u.jsx(V,{as:yt,onScroll:()=>{const a=s.current;s.current=!0,a!==s.current&&r(!1)},onScrollEnd:()=>{s.current=!1,r(!0)},children:o.map((a,d)=>u.jsx(wt,{isStart:d===0,isEnd:d===o.length-1,onUp:()=>{n(l=>{const c=[...l];return c.splice(d-1,0,c.splice(d,1)[0]),c})},onDown:()=>{n(l=>{const c=[...l];return c.splice(d+1,0,c.splice(d,1)[0]),c})},onDelete:()=>{n(l=>{const c=[...l];return c.splice(d,1),c})},children:a.data},a.id))})})}),u.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:8,height:40,maxHeight:40,background:"white"},children:u.jsx("button",{onClick:()=>{n(a=>[...a,e()])},children:"append"})})]})}},Rt=["Default"];export{Wt as Default,Rt as __namedExportsOrder,St as default};
